<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Crypto-JS Test Suite (Dev)</title>

    <!-- YUI Test -->
    <script src="yui/3.2.0/build/yui/yui-min.js"></script>

    <!-- Crypto-JS -->
    <script src="../src/Core.js"></script>
    <script src="../src/MARC4.js"></script>

    <!-- Tests -->
    <script type="text/javascript">

      YUI().use("test", "console", "event", function (Y)
      {
        Y.Test.Runner.add(new Y.Test.Case(
        {
          name: "Core",

          "test WordArray setSigBytes": function ()
          {
            var w1 = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF]);
            var w2 = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF], 7);
            var w3 = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF], 6);
            w3.setSigBytes(5);

            Y.Assert.isUndefined(w1.sigBytes);
            Y.Assert.areEqual(7, w2.sigBytes);
            Y.Assert.areEqual(5, w3.sigBytes);
          },

          "test WordArray getSigBytes": function ()
          {
            var w1 = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF]);
            var w2 = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF], 7);
            var w3 = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF], 6);
            w3.setSigBytes(5);

            Y.Assert.areEqual(8, w1.getSigBytes());
            Y.Assert.areEqual(7, w2.getSigBytes());
            Y.Assert.areEqual(5, w3.getSigBytes());
          },

          "test WordArray cat": function ()
          {
            var w1 = CryptoJS.typ.WordArray([0x01234500], 3);
            var w2 = CryptoJS.typ.WordArray([0x01234500], 3);
            var w3 = w1.cat(w2);

            Y.Assert.areEqual(Object.prototype.toString.apply([0x01234501, 0x23450000]), Object.prototype.toString.apply(w3));
            Y.Assert.areEqual(6, w3.getSigBytes());
          },

          "test ByteStr encode": function ()
          {
            Y.Assert.areEqual("Hello, World!", CryptoJS.enc.ByteStr.encode(CryptoJS.typ.WordArray([0x48656c6c, 0x6f2c2057, 0x6f726c64, 0x21000000], 13)));
          },

          "test Utf8Str encode": function ()
          {
            Y.Assert.areEqual("$", CryptoJS.enc.Utf8Str.encode(CryptoJS.typ.WordArray([0x24000000], 1)));
            Y.Assert.areEqual("¢", CryptoJS.enc.Utf8Str.encode(CryptoJS.typ.WordArray([0xC2A20000], 2)));
            Y.Assert.areEqual("€", CryptoJS.enc.Utf8Str.encode(CryptoJS.typ.WordArray([0xE282AC00], 3)));
            Y.Assert.areEqual("𤭢", CryptoJS.enc.Utf8Str.encode(CryptoJS.typ.WordArray([0xF0A4ADA2], 4)));
          },

          "test Hex encode": function ()
          {
            Y.Assert.areEqual("48656c6c6f2c20576f726c6421", CryptoJS.enc.Hex.encode(CryptoJS.typ.WordArray([0x48656c6c, 0x6f2c2057, 0x6f726c64, 0x21000000], 13)));
          },

          "test Base64 encode": function ()
          {
            Y.Assert.areEqual("FPucA9l+", CryptoJS.enc.Base64.encode(CryptoJS.typ.WordArray([0x14FB9C03, 0xD97E0000], 6)));
            Y.Assert.areEqual("FPucA9k=", CryptoJS.enc.Base64.encode(CryptoJS.typ.WordArray([0x14FB9C03, 0xD9000000], 5)));
            Y.Assert.areEqual("FPucAw==", CryptoJS.enc.Base64.encode(CryptoJS.typ.WordArray([0x14FB9C03, 0x00000000], 4)));
          },

          "test MARC4 doEncrypt": function ()
          {
            CryptoJS.MARC4.drop = 0;

            var message = CryptoJS.typ.WordArray([0, 0]);
            var key = CryptoJS.typ.WordArray([0x01234567, 0x89ABCDEF]);
            CryptoJS.MARC4.doEncrypt(message, key);
            Y.Assert.areEqual("7494c2e7104b0879", message);

            var message = CryptoJS.typ.WordArray([0xDCEE4CF9, 0x2C000000], 5);
            var key = CryptoJS.typ.WordArray([0x618A63D2, 0xFB000000], 5);
            CryptoJS.MARC4.doEncrypt(message, key);
            Y.Assert.areEqual("f13829c9de", message);
          },

          "test MARC4 drop": function ()
          {
            var key = CryptoJS.typ.WordArray([0, 0, 0, 0]);

            CryptoJS.MARC4.drop = 0;
            var messageDrop0 = CryptoJS.typ.WordArray([0, 0, 0, 0]);
            CryptoJS.MARC4.doEncrypt(messageDrop0, key);

            CryptoJS.MARC4.drop = 1;
            var messageDrop1 = CryptoJS.typ.WordArray([0, 0, 0, 0]);
            CryptoJS.MARC4.doEncrypt(messageDrop1, key);

            CryptoJS.MARC4.drop = 2;
            var messageDrop2 = CryptoJS.typ.WordArray([0, 0, 0, 0]);
            CryptoJS.MARC4.doEncrypt(messageDrop2, key);

            Y.Assert.areEqual(CryptoJS.typ.WordArray(messageDrop0[2]).toString(), CryptoJS.typ.WordArray(messageDrop2[0]).toString());
            Y.Assert.areEqual(CryptoJS.typ.WordArray(messageDrop0[1]).toString(), CryptoJS.typ.WordArray(messageDrop1[0]).toString());
          }
        }));

        Y.on("domready", function ()
        {
          var console = new Y.Console({
            newestOnTop: false,
            width: "600px",
            height: "450px",
            style: "block"
          });
          console.render();

          Y.Test.Runner.run();
        });
      });

    </script>

    <!-- Custom console styles -->
    <style type="text/css">

      /* Hide irrelevant data */

      .yui3-console-entry-info,
      .yui3-console-entry-time,
      .yui3-console-entry-src
      {
        display: none;
      }


      /* Streamline entries */

      .yui3-skin-sam .yui3-console-entry-meta,
      .yui3-skin-sam .yui3-console-entry-content
      {
        display: inline-block;
        vertical-align: top;
      }

      .yui3-skin-sam .yui3-console-bd .yui3-console-entry
      {
        min-height: 0;
        padding: 3px 0;
      }


    </style>

  </head>
  <body class="yui3-skin-sam">
  </body>
</html>
