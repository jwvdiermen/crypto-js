<!DOCTYPE html>
<html>
    <head>
        <title>CryptoJS Profile</title>

        <!-- CryptoJS -->
        <script src="../src/core.js"></script>
        <script src="../src/base64.js"></script>
        <script src="../src/hasher.js"></script>
        <script src="../src/md5.js"></script>
        <script src="../src/sha1.js"></script>
        <script src="../src/sha256.js"></script>
        <script src="../src/hmac.js"></script>
        <script src="../src/pbkdf2.js"></script>

        <!-- YUI -->
        <script src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"></script>

        <!-- Profiler -->
        <script type="text/javascript">
            YUI().use('profiler', 'console', 'console-filters', function (Y) {
                // Register objects
                Y.Profiler.registerObject('CryptoJS.oop.BaseObj');
                Y.Profiler.registerObject('CryptoJS.enc.Hex');
                Y.Profiler.registerObject('CryptoJS.enc.ByteStr');
                Y.Profiler.registerObject('CryptoJS.enc.Utf8Str');
                Y.Profiler.registerObject('CryptoJS.enc.Base64');
                Y.Profiler.registerObject('CryptoJS.enc.Base64.UrlSafe');
                Y.Profiler.registerObject('CryptoJS.lib.WordArray');
                Y.Profiler.registerObject('CryptoJS.lib.CmdChain');
                Y.Profiler.registerObject('CryptoJS.lib.Hash');
                Y.Profiler.registerObject('CryptoJS.lib.Hasher');
                Y.Profiler.registerObject('CryptoJS.algo.MD5');
                Y.Profiler.registerObject('CryptoJS.algo.SHA1');
                Y.Profiler.registerObject('CryptoJS.algo.SHA256');
                Y.Profiler.registerObject('CryptoJS.algo.HMAC');
                Y.Profiler.registerObject('CryptoJS.algo.PBKDF2');

                // Code to profile
                var profilees = [
                    {
                        name: 'MD5',
                        fn: function () {
                            var md5 = CryptoJS.algo.MD5.create();
                            for (var i = 0; i < 100; i++) {
                                md5.update('12345678901234567890123456789012345678901234567890');
                            }
                            var hash = md5.compute().toString();
                        }
                    },
                    {
                        name: 'SHA1',
                        fn: function () {
                            var sha1 = CryptoJS.algo.SHA1.create();
                            for (var i = 0; i < 100; i++) {
                                sha1.update('12345678901234567890123456789012345678901234567890');
                            }
                            var hash = sha1.compute().toString();
                        }
                    },
                    {
                        name: 'SHA256',
                        fn: function () {
                            var sha256 = CryptoJS.algo.SHA256.create();
                            for (var i = 0; i < 100; i++) {
                                sha256.update('12345678901234567890123456789012345678901234567890');
                            }
                            var hash = sha256.compute().toString();
                        }
                    },
                    {
                        name: 'HMAC',
                        fn: function () {
                            var hmac = CryptoJS.algo.HMAC.create(CryptoJS.algo.MD5, 'Hi There');
                            for (var i = 0; i < 100; i++) {
                                hmac.update('12345678901234567890123456789012345678901234567890');
                            }
                            var hash = hmac.compute().toString();
                        }
                    },
                    {
                        name: 'PBKDF2',
                        fn: function () {
                            CryptoJS.algo.PBKDF2.compute("password", "ATHENA.MIT.EDUraeburn", { keySize: 256/32, iterations: 10 });
                        }
                    }
                ];

                // Iterate over profilees
                for (var i = 0; i < profilees.length; i++) {
                    var profilee = profilees[i];

                    // Run code to profile
                    profilee.fn();

                    // Get the information
                    var reports = Y.Profiler.getFullReport(function (report) {
                        // Skip reports with 0 calls
                        if ( ! report.calls) return false;

                        // Create 'total' entry
                        report.total = 0;
                        for (var i = 0; i < report.points.length; i++) {
                            report.total += report.points[i];
                        }

                        return true;
                    });

                    // Sort reports by total time
                    var orderedReports = [];
                    for (var f in reports) {
                        orderedReports.push({
                            name: f,
                            report: reports[f]
                        });
                    }
                    orderedReports.sort(function (a, b) {
                        return (
                            (b.report.total - a.report.total) ||
                            (b.report.calls - a.report.calls)
                        );
                    });

                    // Create console
                    var yconsole = new Y.Console({
                        style: 'block',
                        width: '100%',
                        height: '600px',
                        entryTemplate:
                          ' <div class="{entry_class} {cat_class} {src_class}">' +
                          '     <pre class="{entry_content_class}">{message}</pre>' +
                          ' </div>',
                        strings: {
                            title: profilee.name,
                            pause: 'Pause',
                            clear: 'Clear',
                            collapse: 'Collapse',
                            expand: 'Expand'
                        },
                        newestOnTop: false,
                        plugins: [ Y.Plugin.ConsoleFilters ],
                        render: true
                    });

                    // Hide other profile sources
                    for (var j = 0; j < profilees.length; j++) {
                        yconsole.filter.hideSource(profilees[j].name);
                    }
                    yconsole.filter.showSource(profilee.name);

                    // Keep each yconsole in closure
                    (function (yconsole) {
                        Y.on('domready', function () {
                            yconsole.collapse();
                        });
                    }(yconsole));

                    // Log reports
                    for (var j = 0; j < orderedReports.length; j++) {
                        var name = orderedReports[j].name;
                        var report = orderedReports[j].report;

                        Y.log(
                            '[' + report.total + 'ms] ' + name + '(): ' +
                            'Called ' + report.calls + ' times. ' +
                            'Avg: '   + (Math.round(report.avg * 10000) / 10000) + 'ms, ' +
                            'Min: '   + report.min   + 'ms, ' +
                            'Max: '   + report.max   + 'ms',
                            null,
                            profilee.name
                        );
                    }

                    // Clear report data
                    Y.Profiler.clear();
                }
            });
        </script>

        <!-- Console -->
        <style type="text/css">
            body.yui3-skin-sam .yui3-console {
                margin: 1em 0;
            }
            body.yui3-skin-sam .yui3-console-entry-meta,
            body.yui3-skin-sam .yui3-console-entry-content {
                display: inline-block;
                vertical-align: top;
            }

            body.yui3-skin-sam .yui3-console-entry-cat {
                display: inline-block;
                width: 35px;
                text-align: center;
            }

            body.yui3-skin-sam .yui3-console-entry {
                min-height: 0;
            }

            body.yui3-skin-sam .yui3-console-ft .yui3-console-filters-categories,
            body.yui3-skin-sam .yui3-console-ft .yui3-console-filters-sources {
                display: none;
            }
        </style>
    </head>
    <body class="yui3-skin-sam">
    </body>
</html>
